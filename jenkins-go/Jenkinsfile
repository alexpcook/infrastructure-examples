pipeline {
	agent any
	stages {
		stage("build") {
			steps {
				dir("jenkins-go") {
					sh "go version"
					sh "go fmt ./..."
					// set an upper limit on the timeout for a step
					timeout(time: 2, unit: "MINUTES") {
					    sh "sleep 100"
					}
					// set a limit on the number of retries for a step
					retry(5) {
					    sh "go run build.go"
					}
				}
			}
		}
		stage("test") {
			steps {
				dir("jenkins-go") {
					sh "go test -v ./..."
				}
			}
		}
	}
}
